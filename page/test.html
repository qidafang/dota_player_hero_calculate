<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="heros.json"></script>
    <script src="players.json"></script>

    <!--黑夜无趣-->
    <script src="players/duge.js"></script>
    <!--性趣黑夜-->
    <script src="players/duge_2.js"></script>

    <!--我叫6娃-->
    <script src="players/feishen.js"></script>
    <!--娜美爱佩刀-->
    <script src="players/feishen_2.js"></script>
    <!--晨轩轩轩-->
    <script src="players/feishen_3.js"></script>

    <!--冷镜0413-->
    <script src="players/guoguo.js"></script>
    <!--冷镜1989-->
    <script src="players/guoguo_2.js"></script>

    <!--我叫李大为-->
    <script src="players/laowu.js"></script>
    <!--不爱听你的-->
    <script src="players/laowu_2.js"></script>

    <!--我是吴大熊-->
    <script src="players/zhege.js"></script>

    <!--我是大匪神-->
    <script src="players/pangzi.js"></script>

    <!--黑夜有趣-->
    <script src="players/daishen.js"></script>

    <!--月痕9873-->
    <script src="players/liushen.js"></script>


    <!--ztzl-->
    <script src="players/_paoge.js"></script>

    <!--钻井大神-->
    <script src="players/_xg.js"></script>
    <!--大将军救命-->
    <script src="players/_longshen.js"></script>

    <!--大哥430-->
    <script src="players/_dage430.js"></script>
    <!--大哥357-->
    <script src="players/_dage357.js"></script>
    <script>
    var tagNames = [
    '近战', '远程',
    '力量', '敏捷', '智力',
    '辅助', '法师', '打野', '肉盾', 'Gank', '后期', '大后期',
    '点控', '小团控', '团控', '减速', '沉默', '爆发',
    '推进', '治疗', '召唤', '隐身', '闪烁',
    '不稳定', '特殊', '多线'
    ];
    var typeNames = [
     'dps', 'push', 'gank', 'support', 'meat', 'war'
    ];

    var typeAvgs = {};

    typeNames.forEach(function(tn){
        var total = 0;
        heros.forEach(function(h){
            total += h[tn];
        });
        var avg = total / heros.length;
        typeAvgs[tn] = avg;
    });

    var they = {
        '杜哥' : [duge, duge_2],
        '匪神' : [feishen, feishen_2, feishen_3], 
        '蝈蝈' : [guoguo, guoguo_2],
        '老吴' : [laowu, laowu_2],
        '胖子' : [pangzi], 
        '哲哥' : [zhege],
        '呆神' : [daishen],
        '刘神' : [liushen]

        //'炮哥' : [paoge],

        //'刚神' : [xg],
        //'龙神' : [longshen],

        //'430' : [dage430],
        //'357' : [dage357]
    };

    var results = {};//所有人的统计结果汇总集合
    var heroCount = {};//英雄统计汇总
    heros.forEach(function(h){
        heroCount[h.name] = {
            'name' : h.name,
            'total' : 0,
            'win' : 0,
            'herokill' : 0,
            'roshan' : 0,
            'mvp' : 0,
            'offline' : 0
        };
    });

    for(var n in they){
        var records = they[n];
        var playerResult = doIt(records, n);
        results[n] = playerResult;
    }

    console.log(JSON.stringify(results));


    var heroCountList = [];
    for(var hName in heroCount){
        heroCountList.push(heroCount[hName]);
    };
    var lookName = 'offline';
    heroCountList.sort(function(a, b){
        return - (a[lookName] / a.total - b[lookName] / b.total);
    });
    warn(lookName + "最高的英雄：");
    for(var i = 0; i < heroCountList.length; i++){
        var h = heroCountList[i];
        console.log(h.name + "" + two(h[lookName] / h.total * 100));
    }
    warn("==========");





    for(var n in they){
        var records = they[n];

        var matchs = 0;
        var wins = 0;
        var losts = 0;
        var kills = 0;
        var deads = 0;
        var assists = 0;

        var mvps = 0;
        var pianjiangs = 0;
        var yinghuns = 0;

        var zhengbu = 0;
        var fanbu = 0;
        var yeguai = 0;
        var ta = 0;//摧毁塔
        var jingji = 0;//经济
        var roshan = 0;//杀死boss次数

        records.forEach(function(r){

            wins += r.mjInfos.Win;
            losts += r.mjInfos.Lost;
            matchs += (r.mjInfos.Win + r.mjInfos.Lost);
            kills += r.mjInfos.HeroKill;
            deads += r.mjInfos.HeroDeath;
            assists += r.mjInfos.HeroAssist;
            mvps += r.mjInfos.MVP;

            pianjiangs += r.mjInfos.PianJiang;
            yinghuns += r.mjInfos.YingHun;

            zhengbu += r.mjInfos.HeroHit;
            fanbu += r.mjInfos.HeroDeny;
            yeguai += r.mjInfos.NeutralKill;
            ta += r.mjInfos.HitTower;
            roshan += r.mjInfos.Roshan;

            wins += r.ttInfos.Win;
            losts += r.ttInfos.Lost;
            matchs += (r.ttInfos.Win + r.ttInfos.Lost);
            kills += r.ttInfos.HeroKill;
            deads += r.ttInfos.HeroDeath;
            assists += r.ttInfos.HeroAssist;
            mvps += r.ttInfos.MVP;

            pianjiangs += r.ttInfos.PianJiang;
            yinghuns += r.ttInfos.YingHun;

            zhengbu += r.ttInfos.HeroHit;
            fanbu += r.ttInfos.HeroDeny;
            yeguai += r.ttInfos.NeutralKill;
            ta += r.ttInfos.HitTower;
            roshan += r.ttInfos.Roshan;

        });

        var jingji = (zhengbu + (n=='杜哥' ? yeguai / 2 : yeguai));
        var ka = (kills + assists); 
        /*
        console.log(n + "胜率：" + two(wins / matchs) + "，场均击杀/死亡/助攻：" + two(kills/matchs) + "/" + two(deads/matchs) + "/" + two(assists/matchs) + "，KDA：" + two((kills + assists) / (deads)) + "，杀人/助攻比：" + two(kills / assists));
        */
        console.log(
        //n + "每100场(MVP+英魂)数：" + two((mvps + yinghuns) / matchs * 100)
        //n + "每场杀死野怪数：" + two(yeguai / matchs)
        //+ "每场正补：" + two(zhengbu / matchs)
        //n + "每个杀人或助攻需要经济：" + two( jingji /ka )
        //n + "毒瘤指数：" + two((jingji) / (kills + assists) * (losts / (wins + losts)))
        //n + "每100场推塔数：" + two(ta / matchs * 100)
        //n + "每100场杀死肉山次数：" + two(roshan / matchs * 100)
         );
        //console.log(n + "的K头指数：" + two(kills / assists * 100) );
    }


    function two(n){
        return Math.round(n * 100) / 100;
    }


    function doIt(ps, playerName){
        console.warn("========");

        var win = {};//标签：胜场
        var total = {};//标签：总场次
        var typeWin = {};//类别：胜场
        var typeTotal = {};//类别：总场次

        for(var i = 0; i < tagNames.length; i++){
            var t = tagNames[i];
            win[t] = 0;
            total[t] = 0;
        }
        for(var i = 0; i < typeNames.length; i++){
            var t = typeNames[i];
            typeWin[t] = 0;
            typeTotal[t] = 0;
        }


        for(var i = 0; i < heros.length; i++){//遍历所有英雄
            var h = heros[i];
            var name = h.name;

            var winCount = 0;//该英雄所有id胜场
            var totalCount = 0;//该英雄所有id场次
            var typeSumCount = 0;

            ps.forEach(function(p){//遍历所有id
                var infoThisId = null;//本id本英雄的数据
                for(var j = 0; j < p.mjheroInfos.length && infoThisId == null; j++){
                    var oneHero = p.mjheroInfos[j];
                    if(changeName(oneHero.heroname) == name){
                        infoThisId = oneHero;
                    }
                }
                if(infoThisId != null){//这个号用过这个英雄
                    var timesThisId = infoThisId.win + infoThisId.lost;//这个号这个英雄的场次
                    var winCountThisId = infoThisId.win;//这个号这个英雄的胜场

                    totalCount += timesThisId;
                    winCount += winCountThisId;

                    heroCount[name]['total'] += timesThisId;
                    heroCount[name]['win'] += winCountThisId;
                    heroCount[name]['herokill'] += infoThisId.herokill;
                    heroCount[name]['roshan'] += infoThisId.roshan;
                    heroCount[name]['mvp'] += infoThisId.mvp;
                    heroCount[name]['offline'] += infoThisId.offline;
                }

            });

            var heroWinRate = totalCount > 0 ? winCount / totalCount : 0;

            var tags = h.tags.split(",");
            for(var k = 0; k < tags.length; k++){
                var t = tags[k];
                win[t] += winCount;
                total[t] += totalCount;
            }
            for(var k = 0; k < typeNames.length; k++){
                var t = typeNames[k];

                if(h[t] > 5){//指标超过5代表是这个类别
                }

                typeWin[t] += winCount * (h[t] / typeAvgs[t]);
                typeTotal[t] += totalCount;
            }
        }

        var result = {};

        var totalwin = 0;//总胜场
        for(var i = 0; i < tagNames.length; i++){
            var t = tagNames[i];
            totalwin += win[t];
        }
        var totaltypewin = 0;//类别总分
        for(var i = 0; i < typeNames.length; i++){
            var t = typeNames[i];
            totaltypewin += typeWin[t];
        }

        for(var i = 0; i < tagNames.length; i++){//标签和值
            var t = tagNames[i];
            //var score = Math.round((win[t] / total[t]) * 100);//标签胜率
            var score = Math.round((win[t] / totalwin) * 100);//标签胜率
            result[t] = score;
            //console.log(t + ":" + score);
        }
        for(var i = 0; i < typeNames.length; i++){//类别和值
            var t = typeNames[i];
            //var score = Math.round((typeWin[t] / typeTotal[t]) * 100);//类别胜率
            var score = Math.round((typeWin[t] / totaltypewin) * 100);//类别胜率
            result[t] = score;
            //console.log(t + ":" + typeWin[t] / typeTotal[t]);
        }

        return result;
    }

    function changeName(n){
        var map = {
            '舰队统帅':'海军上将',
            '嗜血狂魔':'血魔',
            '发条地精':'发条技师',
            '蝮蛇':'冥界亚龙',
            '熊猫酒仙':'酒仙',
            '撼地神牛':'撼地者',
            '刚背兽':'钢背兽',
            '剑圣':'主宰',
            '地穴刺客':'司夜刺客',
            '半人马酋长':'半人马战行者',
            '寒冬巨龙':'寒冬飞龙',
            '地穴编织者':'编织者',
            '月之女祭司':'月之公主',
            '死灵法师':'瘟疫法师',
            '闪电幽魂':'剃刀',
            '牛头人酋长':'上古巨神',
            '骷髅射手':'骷髅弓箭手',
            '灵魂守卫':'恐怖利刃',
            '矮人狙击手':'狙击手',
            '奥林匹斯之王':'宙斯',
            '地精工程师':'炸弹人',
            '美杜莎':'蛇发女妖',
            '黑曜毁灭者':'殁境神蚀者'
        };
        var newName = map[n];
        return newName || n;
    }


    function warn(msg){
        console.warn(msg);
    }
    function error(msg){
        console.error(msg);
    }
    </script>
</body>
</html>
